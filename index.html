<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Content Security Policy (fuerte) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; base-uri 'none'; object-src 'none';
                 img-src 'self' data:; style-src 'self' 'unsafe-inline';
                 script-src 'self' 'nonce-abc123'; frame-ancestors 'none';
                 form-action 'self'; upgrade-insecure-requests">

  <title>F√∏lgeseddel - Felson Watersafe ApS</title>

  <style>
    /* ===== Base ===== */
    *{margin:0;padding:0;box-sizing:border-box}
    html, body{height:100%}
    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh; padding:2rem; display:flex; justify-content:center; align-items:center;
      color:#1f2733;
    }
    .container{width:100%;max-width:1000px}
    .doc{
      background:#fff; border-radius:12px; overflow:hidden;
      box-shadow:0 20px 60px rgba(0,0,0,.25);
      display:flex; flex-direction:column;
    }

    /* ===== Header ===== */
    .doc__header{
      padding:2rem 3rem; display:flex; justify-content:flex-end; align-items:center;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      border-bottom:0;
    }
    .logo{color:#fff;font-weight:800;letter-spacing:1px}

    /* ===== Content ===== */
    .doc__content{padding:2.5rem 3rem 2rem}
    h1.title{
      text-align:center; text-transform:uppercase; letter-spacing:1.6px;
      margin-bottom:2rem; color:#2d3748; font-size:2rem; font-weight:800;
    }

    /* Details: Dato izq | Levering der; Ordre nr. full width abajo */
    .details{
      display:grid; grid-template-columns:1fr 1fr; gap:1.25rem 2rem; align-items:start; margin-bottom:1.8rem;
    }
    .details .full{grid-column:1 / -1}
    .label{display:block; font-weight:700; color:#3b4452; margin-bottom:.45rem; font-size:.95rem}
    .field, .area{
      width:100%; padding:.75rem; border:2px solid #e2e8f0; border-radius:8px;
      background:#f7fafc; font:inherit; font-size:1rem; transition:.2s;
    }
    .field:focus, .area:focus{outline:none;border-color:#667eea;background:#fff;box-shadow:0 0 0 3px rgba(102,126,234,.12)}
    .area{min-height:100px; resize:vertical}

    /* ===== Table ===== */
    .table-wrap{margin-top:.25rem}
    table.items{
      width:100%; border-collapse:separate; border-spacing:0; table-layout:fixed;
      border:2px solid #e2e8f0; border-radius:8px; overflow:hidden;
    }
    .items thead{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}
    .items th{
      padding:12px 14px; text-align:left; color:#fff; text-transform:uppercase; font-size:.85rem; letter-spacing:.5px;
      border-right:2px solid rgba(255,255,255,.35);
    }
    .items th:last-child{border-right:none}
    .items th.qty{width:20%}

    .items tbody tr{border-bottom:1px solid #e2e8f0}
    .items td{padding:.75rem 12px; vertical-align:top; background:#fff}
    .items td.qty{border-right:1px solid #e2e8f0}

    .cell{
      width:100%; padding:.55rem .6rem; border:1px solid #cbd5e0; border-radius:6px; background:#fff;
      font:inherit; font-size:.95rem; transition:.2s;
    }
    .cell:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.12)}
    .cell.area{min-height:42px; line-height:1.4; resize:vertical; overflow:hidden}
    .controls{ width:60px; text-align:center }

    .btn-del{
      background:transparent; border:none; color:#e53e3e; cursor:pointer; font-size:1.25rem;
      padding:.5rem; border-radius:6px; transition:.15s;
    }
    .btn-del:hover{ background:#fff5f5; transform:scale(1.07) }

    /* ===== Action buttons ===== */
    .actions{ display:flex; gap:1rem; justify-content:center; padding:1.2rem 3rem 2rem }
    .btn{
      padding:1rem 2.4rem; border-radius:10px; cursor:pointer; font-weight:700; font-size:1rem;
      text-transform:uppercase; letter-spacing:.5px; transition:.2s; border:2px solid transparent;
      min-width:210px;
    }
    .btn.primary{ background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; box-shadow:0 6px 16px rgba(102,126,234,.35) }
    .btn.primary:hover{ transform:translateY(-2px); box-shadow:0 10px 24px rgba(102,126,234,.45) }
    .btn.secondary{ background:#fff; color:#667eea; border-color:#667eea }
    .btn.secondary:hover{ background:#667eea; color:#fff; transform:translateY(-2px) }

    .btn-add{
      display:inline-block; margin:.75rem 0 0; background:linear-gradient(135deg,#48bb78 0%,#38a169 100%);
      color:#fff; border:none; padding:.7rem 1.25rem; border-radius:8px; font-weight:700; cursor:pointer;
      box-shadow:0 4px 12px rgba(72,187,120,.3); transition:.2s;
    }
    .btn-add:hover{ transform:translateY(-2px); box-shadow:0 8px 18px rgba(72,187,120,.4) }

    /* ===== Footer ===== */
    .doc__footer{
      padding:1.25rem 3rem; background:#f7fafc; border-top:2px solid #e2e8f0; color:#667085;
      text-align:center; font-size:.92rem;
    }

    /* ===== Responsive ===== */
    @media (max-width:768px){
      body{padding:1rem}
      .doc__content{padding:2rem 1.25rem 1.25rem}
      .details{grid-template-columns:1fr}
      .actions{flex-direction:column}
      .btn{width:100%}
    }

    /* ===== Print (cl√°sico) ===== */
    @media print{
      @page{ size:A4; margin:2cm }
      body{ background:#fff; padding:0; color:#000; font-family:'Times New Roman', Times, serif }
      .doc{ box-shadow:none; border-radius:0 }
      .doc__header{ background:#fff !important; border-bottom:2px solid #000 !important }
      .logo{ color:#000 !important; font-weight:700 }
      .actions, .btn-add, .btn-del{ display:none !important }

      h1.title{
        color:#000; font-weight:normal; font-size:1.35rem; text-decoration:underline;
        margin:1.6rem 0 1.2rem;
      }

      /* Table: BN, rejilla y separador vertical */
      table.items{ border:1px solid #000 !important }
      .items thead{ background:#fff !important; border-bottom:2px solid #000 !important }
      .items th{ color:#000 !important; border-right:1px solid #000 !important }
      .items th:last-child{ border-right:none !important }
      .items td{ border-top:1px solid #000 !important }
      .items td.qty{ border-right:1px solid #000 !important }

      /* Inputs ‚Üí texto plano */
      input.cell, textarea.cell{ border:none !important; background:transparent !important; padding:0 !important; box-shadow:none !important }

      /* Oculta col. de controles en impresi√≥n */
      .items th.controls, .items td.controls{ display:none !important }
    }
  </style>
</head>
<body>
  <main class="container">
    <article class="doc" role="document" aria-label="F√∏lgeseddel">
      <header class="doc__header">
        <h2 class="logo">FELSON WATERSAFE ApS</h2>
      </header>

      <section class="doc__content">
        <h1 class="title">F√òLGESEDDEL</h1>

        <!-- Details: Dato (left) | Levering (right) -->
        <section class="details" aria-label="Detaljer">
          <div>
            <label for="dato" class="label">Dato</label>
            <input id="dato" type="date" class="field" autocomplete="off" />
          </div>
          <div>
            <label for="levering" class="label">Levering</label>
            <textarea id="levering" class="area" placeholder="Leveringsadresse"></textarea>
          </div>
          <div class="full">
            <label for="ordre" class="label">Ordre nr.</label>
            <input id="ordre" type="text" class="field" placeholder="Indtast ordrenummer" autocomplete="off" inputmode="numeric"/>
          </div>
        </section>

        <!-- Items table -->
        <div class="table-wrap">
          <table class="items" aria-label="Varelinjer">
            <thead>
              <tr>
                <th class="qty">Antal</th>
                <th>Beskrivelse</th>
                <th class="controls" aria-hidden="true"></th>
              </tr>
            </thead>
            <tbody id="rows">
              <tr>
                <td class="qty">
                  <input class="cell" type="number" min="0" step="1" inputmode="numeric" pattern="[0-9]*" placeholder="0" />
                </td>
                <td>
                  <textarea class="cell area" rows="1" placeholder="Beskrivelse af vare"></textarea>
                </td>
                <td class="controls">
                  <button class="btn-del" type="button" title="Slet r√¶kke" aria-label="Slet r√¶kke">üóëÔ∏è</button>
                </td>
              </tr>
            </tbody>
          </table>
          <button id="add" class="btn-add" type="button">+ Tilf√∏j R√¶kke</button>
        </div>
      </section>

      <section class="actions" aria-label="Handling">
        <button id="save" class="btn secondary" type="button">Gem som PDF</button>
        <button id="print" class="btn primary" type="button">Udskriv</button>
      </section>

      <footer class="doc__footer">
        <p>Felson Watersafe ApS ‚Ä¢ Gartnervej 4 ‚Ä¢ 6710 Esbjerg V</p>
        <p>CVR-nr. DK26813522 ‚Ä¢ Tlf. 70206676 ‚Ä¢ felson@felson.dk</p>
      </footer>
    </article>
  </main>

  <!-- JS sin inline handlers, protegido por CSP nonce -->
  <script nonce="abc123">
    (function(){
      'use strict';

      // Prefill today's date (yyyy-mm-dd)
      const d = document.getElementById('dato');
      if (d) {
        const t = new Date();
        const yyyy = t.getFullYear();
        const mm = String(t.getMonth()+1).padStart(2,'0');
        const dd = String(t.getDate()).padStart(2,'0');
        d.value = `${yyyy}-${mm}-${dd}`;
      }

      // Auto-resize for description textareas (and Levering)
      function autoGrow(el){
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
      }
      document.addEventListener('input', (e) => {
        const t = e.target;
        if (t && (t.classList && t.classList.contains('area'))) {
          autoGrow(t);
        }
      });
      // Initialize current areas
      document.querySelectorAll('.area').forEach(autoGrow);

      // Add row (screen only; print hides button)
      const rows = document.getElementById('rows');
      document.getElementById('add').addEventListener('click', () => {
        const tr = rows.lastElementChild.cloneNode(true);
        tr.querySelectorAll('input, textarea').forEach(el => {
          el.value = '';
          if (el.classList.contains('area')) autoGrow(el);
        });
        rows.appendChild(tr);
      });

      // Delete row (screen only)
      rows.addEventListener('click', (e) => {
        const btn = e.target.closest('.btn-del');
        if (!btn) return;
        const allRows = rows.querySelectorAll('tr');
        if (allRows.length > 1) {
          btn.closest('tr').remove();
        } else {
          alert('Skal have mindst √©n r√¶kke');
        }
      });

      // Print/PDF buttons (solo abren el di√°logo; CSS hace el resto)
      const triggerPrint = () => window.print();
      document.getElementById('save').addEventListener('click', triggerPrint);
      document.getElementById('print').addEventListener('click', triggerPrint);

      // Defensa extra contra inyecci√≥n: nunca usamos innerHTML con entrada del usuario.
      // Al imprimir, CSS quita el "chrome" de los inputs para que se vean como texto.
    })();
  </script>
</body>
</html>
