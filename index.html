<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>F√∏lgeseddel - Felson Watersafe ApS</title>
  <meta name="color-scheme" content="light only" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --brand: #00B0F0; --brand-2: #0090cc; --ink: #1a1a1a; --muted: #6b7280; --border: #e5e7eb;
      --ok: #10b981; --danger: #ef4444; --surface: rgba(255,255,255,.98);
    }
    body {
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, var(--brand) 100%);
      min-height: 100vh; padding: 2rem; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility;
    }

    /* ===== LOGIN SCREEN ===== */
    .login-screen { position: fixed; inset: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, var(--brand) 100%); display: flex; align-items: center; justify-content: center; z-index: 20000; padding: 1rem; opacity: 1; transition: opacity .5s, visibility .5s; }
    .login-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    .login-card { background: var(--surface); backdrop-filter: blur(20px); border-radius: 24px; box-shadow: 0 25px 50px -12px rgba(0,0,0,.5); max-width: 460px; width: 100%; overflow: hidden; animation: slideUp .6s ease-out; }
    @keyframes slideUp { from{ opacity:0; transform:translateY(30px);} to{ opacity:1; transform:translateY(0);} }
    .login-header { background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%); padding: 3rem 2rem 2rem; text-align: center; position: relative; overflow: hidden; }
    .login-header::before { content:""; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background: radial-gradient(circle, rgba(255,255,255,.12) 0%, transparent 70%); animation: pulse 4s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{ transform:scale(1); opacity:.5;} 50%{ transform:scale(1.1); opacity:.8;} }
    .login-icon { width: 84px; height: 84px; background: #fff; border-radius: 50%; display:flex; align-items:center; justify-content:center; font-size:2.5rem; margin:0 auto 1rem; box-shadow: 0 10px 30px rgba(0,0,0,.2); position:relative; z-index:1; }
    .login-logo { font-size:2rem; font-weight:800; color:#fff; margin-bottom:.5rem; position:relative; z-index:1; }
    .login-subtitle { color: rgba(255,255,255,.9); font-size:.9rem; font-weight:600; position:relative; z-index:1; }
    .login-body { padding: 2.5rem 2rem; }
    .login-title { font-size:1.5rem; font-weight:800; color:var(--ink); margin-bottom:.5rem; text-align:center; }
    .login-description { color: var(--muted); font-size:.9rem; text-align:center; margin-bottom:1.25rem; }
    .login-form { display:flex; flex-direction:column; gap:1rem; }
    .input-group { position:relative; }
    .input-icon { position:absolute; left:1rem; top:50%; transform:translateY(-50%); font-size:1.25rem; color:#9ca3af; transition:color .2s; }
    .login-input { width:100%; padding:.875rem 1rem .875rem 3rem; border:2px solid var(--border); border-radius:12px; font-size:.95rem; transition:all .2s; }
    .login-input:focus { outline:none; border-color:var(--brand); box-shadow: 0 0 0 4px rgba(0,176,240,.1); }
    .login-input:focus + .input-icon { color: var(--brand); }
    .login-btn { padding:1rem; border:none; border-radius:12px; font-weight:800; font-size:1rem; cursor:pointer; background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%); color:#fff; transition: all .3s; margin-top:.25rem; position:relative; overflow:hidden; letter-spacing:.02em; }
    .login-btn::before { content:""; position:absolute; top:50%; left:50%; width:0; height:0; border-radius:50%; background: rgba(255,255,255,.3); transform: translate(-50%,-50%); transition: width .6s, height .6s; }
    .login-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,176,240,.3); }
    .login-btn:hover::before { width: 300px; height: 300px; }
    .login-error { background:#fee; border:1px solid #fcc; color:#b91c1c; padding:.75rem; border-radius:10px; font-size:.9rem; text-align:center; display:none; animation:shake .3s; }
    .login-error.show { display:block; }
    @keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-10px);}75%{transform:translateX(10px);}}
    .login-footer { padding:1rem 2rem 1.5rem; background:#f9fafb; text-align:center; font-size:.8rem; color:var(--muted); }
    .login-hint { background:#e0f2fe; border:1px solid #bae6fd; color:#0369a1; padding:.75rem; border-radius:8px; font-size:.85rem; text-align:center; margin-top:1rem; }

    /* ===== MAIN APP ===== */
    .app-container { opacity:0; visibility:hidden; transition: opacity .5s, visibility .5s; }
    .app-container.visible { opacity:1; visibility:visible; }
    .security-badge { position:fixed; top:1rem; right:1rem; background:rgba(16,185,129,.9); color:#fff; padding:.5rem 1rem; border-radius:20px; font-size:.75rem; font-weight:800; cursor:pointer; z-index:1000; transition:all .2s; }
    .security-badge:hover { background:rgba(16,185,129,1); transform:scale(1.05); }
    .logout-badge { position:fixed; top:1rem; left:1rem; background:rgba(239,68,68,.9); color:#fff; padding:.5rem 1rem; border-radius:20px; font-size:.75rem; font-weight:800; cursor:pointer; z-index:1000; transition:all .2s; }
    .logout-badge:hover { background:rgba(239,68,68,1); transform:scale(1.05); }
    .container { max-width: 920px; margin: 0 auto; }
    .card { background: var(--surface); backdrop-filter: blur(20px); border-radius: 24px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,.25); margin-bottom: 2rem; }
    .header { padding: 2.5rem 3rem 2rem; background: linear-gradient(135deg, #fff 0%, #f0f9ff 100%); border-bottom: 2px solid var(--brand); text-align: right; }
    .logo { color: var(--brand); font-size: 2rem; font-weight: 800; }
    .content { padding: 3rem; }
    .title { text-align:center; font-size:1.125rem; font-weight:800; color:var(--ink); margin-bottom: 2.5rem; text-transform: uppercase; letter-spacing: .2em; }
    .form { display:grid; grid-template-columns: 260px 1fr; gap: 2rem; margin-bottom: 2.5rem; }
    .field { margin-bottom:1rem; }
    .label { display:block; font-weight:700; font-size:.8rem; color:var(--muted); margin-bottom:.5rem; text-transform:uppercase; }
    .input, .textarea { width:100%; padding:.75rem 1rem; border:1.5px solid var(--border); border-radius:10px; font-size:.95rem; transition:all .2s; }
    .input:focus, .textarea:focus { outline:none; border-color: var(--brand); box-shadow: 0 0 0 4px rgba(0,176,240,.08); }
    .textarea { resize: vertical; min-height: 100px; }

    .table { width:100%; border-collapse: separate; border-spacing:0; border:1px solid var(--border); border-radius:12px; overflow:hidden; margin-top:1.5rem; }
    .table thead { background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%); }
    .table th { padding:1rem; text-align:left; color:#fff; font-weight:800; text-transform:uppercase; font-size:.75rem; }
    .table th.col-antal { width:20%; text-align:center; }
    .table tbody tr { background:#fff; }
    .table tbody tr:not(:last-child) td { border-bottom:1px solid var(--border); }
    .table tbody td { padding:.75rem 1rem; vertical-align: top; }
    .table-input { width:100%; padding:.5rem; border:1px solid transparent; border-radius:6px; font-size:.95rem; }
    .table-input:focus { outline:none; border-color: var(--brand); background: rgba(0,176,240,.05); }
    .table-textarea { resize:none; overflow:hidden; min-height: 2.5rem; }
    .table-input.col-antal { text-align:center; font-weight:800; color: var(--brand); }

    .actions { margin-top:1rem; display:flex; gap:.75rem; }
    .btn { padding:.625rem 1.25rem; border:none; border-radius:10px; font-weight:800; font-size:.82rem; cursor:pointer; text-transform:uppercase; transition: all .2s; }
    .btn:hover { transform: translateY(-2px); }
    .btn-add { background: linear-gradient(135deg, var(--ok) 0%, #059669 100%); color:#fff; }
    .btn-clear { background: #fff; color: var(--danger); border: 1.5px solid var(--danger); }
    .btn-delete { background: transparent; color:#9ca3af; font-size: 1.125rem; line-height: 1; padding:.25rem .5rem; border-radius:8px; }
    .btn-delete:hover { background:#f3f4f6; color:#111827; }

    .footer { padding:1.5rem 3rem; background:#fff; border-top: 2px solid var(--brand); text-align:center; font-size:.82rem; color:var(--muted); line-height:1.6; font-family:'Poppins', sans-serif; }
    .footer p { margin:.25rem 0; }

    .main-actions { display:flex; gap:1rem; justify-content:center; }
    .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; }
    .btn-brand { background: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%); color:#fff; }

    .toast { position:fixed; bottom:2rem; right:2rem; background:#fff; padding:1rem 1.25rem; border-radius:12px; box-shadow: 0 20px 25px -5px rgba(0,0,0,.1); transform: translateY(100px); opacity:0; transition: all .4s; z-index:10000; }
    .toast.show { transform: translateY(0); opacity: 1; }
    .toast[aria-live] { outline: none; }

    .modal { position:fixed; inset:0; background: rgba(0,0,0,.7); backdrop-filter: blur(8px); display:flex; align-items:center; justify-content:center; z-index:10000; padding:1rem; opacity:0; visibility:hidden; transition: all .3s; }
    .modal.show { opacity:1; visibility:visible; }
    .modal-content { background:#fff; border-radius:16px; max-width:600px; width:100%; padding:2rem; box-shadow: 0 25px 50px -12px rgba(0,0,0,.5); }
    .modal-header { display:flex; align-items:center; gap:1rem; margin-bottom:1.5rem; padding-bottom:1rem; border-bottom:2px solid var(--brand); }
    .modal-icon { width:48px; height:48px; background: linear-gradient(135deg, var(--ok) 0%, #059669 100%); border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:24px; }
    .modal-title { font-size:1.5rem; font-weight:800; }
    .modal-body { color:var(--muted); line-height:1.7; margin-bottom:1.5rem; }
    .modal-body p { margin-bottom:1rem; }
    .features { background:#f9fafb; border-radius:12px; padding:1rem; margin:1rem 0; }
    .features ul{ list-style:none; }
    .features li{ padding:.5rem 0; display:flex; align-items:center; gap:.75rem; }
    .features li::before { content:'‚úì'; color: var(--ok); font-weight:800; font-size:1.125rem; }
    .modal-actions{ display:flex; justify-content:flex-end; gap:.5rem; }

    @media (max-width: 768px) {
      body{ padding:1rem; }
      .form{ grid-template-columns: 1fr; }
      .content{ padding:1.5rem; }
      .logo{ font-size:1.6rem; }
    }

    /* ===== PRINT STYLES ===== */
    @media print {
      @page { size: A4 portrait; margin: 20mm 15mm; }
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; color-adjust: exact !important; }
      html, body { background:#fff !important; padding:0 !important; margin:0 !important; width:100%; height:100%; }
      .login-screen, .security-badge, .logout-badge, .main-actions, .actions, .btn-delete, .toast, .modal { display:none !important; }
      .app-container { opacity:1 !important; visibility:visible !important; }
      .container { max-width:100% !important; margin:0 !important; padding:0 !important; }
      .card { box-shadow:none !important; border-radius:0 !important; margin:0 !important; background:#fff !important; page-break-after:auto; }
      .header { padding: 0 0 8mm 0 !important; background:#fff !important; border-bottom:2.5px solid var(--brand) !important; margin-bottom:8mm !important; page-break-inside:avoid !important; }
      .logo { font-size:20pt !important; color: var(--brand) !important; }
      .content { padding:0 !important; }
      .title { font-size:14pt !important; background: var(--brand) !important; color:#fff !important; padding:4mm 0 !important; border-radius:2mm !important; margin-bottom:8mm !important; text-align:center !important; page-break-inside:avoid !important; page-break-after:avoid !important; }
      .form { grid-template-columns:35% 65% !important; gap:5mm !important; margin-bottom:8mm !important; background:#f8f9fa !important; padding:4mm !important; border-radius:2mm !important; page-break-inside:avoid !important; page-break-after:avoid !important; }
      .field { margin-bottom:3mm !important; }
      .label { font-size:8.5pt !important; color: var(--brand) !important; font-weight:800 !important; margin-bottom:1.5mm !important; }
      .input, .textarea { border:none !important; padding:0 !important; font-size:10pt !important; background:transparent !important; color:#1a1a1a !important; font-weight:400 !important; box-shadow:none !important; }
      .textarea { min-height:auto !important; }
      .table { border:1.5px solid var(--brand) !important; margin-top:6mm !important; border-radius:0 !important; page-break-inside:auto !important; }
      .table thead { display: table-header-group !important; background: var(--brand) !important; page-break-inside:avoid !important; page-break-after:avoid !important; }
      .table th { font-size:9pt !important; padding:3mm !important; color:#fff !important; background: var(--brand) !important; border:none !important; }
      .table tbody { display: table-row-group !important; }
      .table tbody tr { page-break-inside: avoid !important; background: #fff !important; }
      .table tbody tr:nth-child(even) { background: #f8f9fa !important; }
      .table tbody tr:not(:last-child) td { border-bottom:.5px solid #dee2e6 !important; }
      .table tbody td { padding:2.5mm 3mm !important; font-size:10pt !important; color:#1a1a1a !important; border:none !important; }
      .table-input { border:none !important; padding:0 !important; font-size:10pt !important; background:transparent !important; color:#1a1a1a !important; box-shadow:none !important; }
      .table-input.col-antal { font-weight:800 !important; color: var(--brand) !important; }
      .table-textarea { min-height:auto !important; overflow:visible !important; }
      .footer { display:block !important; padding: 6mm 0 0 0 !important; border-top: 2.5px solid var(--brand) !important; text-align:center !important; page-break-inside:avoid !important; margin-top:10mm !important; background:#fff !important; position:relative; }
      .footer p { font-size:8pt !important; margin:1mm 0 !important; color:#495057 !important; }
      h1,h2,h3,h4,h5,h6 { page-break-after:avoid !important; }
      input::-webkit-calendar-picker-indicator, input::-webkit-inner-spin-button, input::-webkit-outer-spin-button { display:none !important; -webkit-appearance:none !important; }
      input[type="date"], input[type="number"] { -moz-appearance: textfield !important; }
      .card { display:block !important; }
    }
  </style>
</head>
<body>
  <!-- LOGIN SCREEN -->
  <div class="login-screen" id="loginScreen" aria-hidden="false">
    <div class="login-card" role="dialog" aria-modal="true" aria-labelledby="loginTitle" aria-describedby="loginDesc">
      <div class="login-header">
        <div class="login-icon" aria-hidden="true">üíß</div>
        <h1 class="login-logo" id="loginTitle">Felson Watersafe ApS</h1>
        <p class="login-subtitle" id="loginDesc">F√∏lgeseddel System</p>
      </div>
      <div class="login-body">
        <h2 class="login-title">Velkommen tilbage</h2>
        <p class="login-description">Log ind for at f√• adgang til f√∏lgeseddel systemet</p>
        <div class="login-error" id="loginError" role="alert">Forkert brugernavn eller adgangskode</div>
        <form class="login-form" id="loginForm" novalidate>
          <div class="input-group">
            <label class="sr-only" for="username">Brugernavn</label>
            <input type="text" class="login-input" id="username" placeholder="Brugernavn" autocomplete="username" required aria-required="true" />
            <span class="input-icon" aria-hidden="true">üë§</span>
          </div>
          <div class="input-group">
            <label class="sr-only" for="password">Adgangskode</label>
            <input type="password" class="login-input" id="password" placeholder="Adgangskode" autocomplete="current-password" required aria-required="true" />
            <span class="input-icon" aria-hidden="true">üîí</span>
          </div>
          <button type="submit" class="login-btn">Log ind</button>
        </form>
        <div class="login-hint" id="demoHint" hidden>
          üí° <strong>Demo:</strong> Bruger: <code>admin</code> | Adgangskode: <code>felson2025</code>
        </div>
      </div>
      <div class="login-footer">üîí Sikker login ‚Ä¢ GDPR-kompatibel ‚Ä¢ AES-256 kryptering</div>
    </div>
  </div>

  <!-- MAIN APPLICATION -->
  <div class="app-container" id="appContainer" aria-hidden="true">
    <button class="security-badge" id="badge" type="button" aria-haspopup="dialog" aria-controls="modal">üîí Sikker og krypteret</button>
    <button class="logout-badge" id="logoutBadge" type="button" aria-label="Log ud">üö™ Log ud</button>

    <div class="container">
      <section class="card" aria-labelledby="docHeader">
        <header class="header">
          <h1 class="logo" id="docHeader">Felson Watersafe ApS</h1>
        </header>
        <div class="content">
          <h2 class="title">F√∏lgeseddel</h2>
          <div class="form">
            <div>
              <div class="field">
                <label class="label" for="dato">Dato</label>
                <input type="date" class="input" id="dato" />
              </div>
              <div class="field">
                <label class="label" for="ordre">Ordre nr.</label>
                <input type="text" class="input" id="ordre" placeholder="Indtast ordrenummer" />
              </div>
            </div>
            <div>
              <div class="field">
                <label class="label" for="levering">Levering</label>
                <textarea class="textarea" id="levering" placeholder="Indtast leveringsadresse"></textarea>
              </div>
            </div>
          </div>

          <table class="table" role="table" aria-label="Vareliste">
            <thead role="rowgroup">
              <tr role="row">
                <th class="col-antal" role="columnheader" scope="col">Antal</th>
                <th role="columnheader" scope="col">Beskrivelse</th>
                <th style="width:60px;" role="columnheader" scope="col" aria-label="Slet r√¶kke"></th>
              </tr>
            </thead>
            <tbody id="tbody" role="rowgroup"></tbody>
          </table>

          <div class="actions">
            <button class="btn btn-add" id="addBtn" type="button">+ Tilf√∏j R√¶kke</button>
            <button class="btn btn-clear" id="clearBtn" type="button">Ryd Alt</button>
          </div>
        </div>
        <footer class="footer" id="footer">
          <p>Felson Watersafe ApS / Gartnervej 4 / 6710 Esbjerg V</p>
          <p>CVR-nr. DK26813522 / Tlf. 70206676 / felson@felson.dk</p>
        </footer>
      </section>

      <div class="main-actions" aria-label="Prim√¶re handlinger">
        <button class="btn btn-brand" id="pdfBtn" type="button">üìÑ Generer PDF</button>
        <button class="btn btn-primary" id="printBtn" type="button">üñ®Ô∏è Udskriv</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <div class="modal" id="modal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modal-header">
        <div class="modal-icon" aria-hidden="true">üîí</div>
        <h3 class="modal-title" id="modalTitle">Sikkerhed og Databeskyttelse</h3>
      </div>
      <div class="modal-body">
        <p>Velkommen til Felson Watersafe ApS f√∏lgeseddel system. Vi tager din datasikkerhed alvorligt.</p>
        <div class="features">
          <ul>
            <li>AES-256 kryptering af alle gemte data</li>
            <li>Lokal lagring uden eksterne servere</li>
            <li>Ingen data deles med tredjeparter</li>
            <li>GDPR-kompatibel databehandling</li>
          </ul>
        </div>
        <p><strong>Din databeskyttelse:</strong> Vi f√∏lger GDPR retningslinjer. Du har fuld kontrol over dine data.</p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-brand" id="acceptBtn" type="button">Forst√•et og Accepter</button>
        <button class="btn btn-clear" id="closeBtn" type="button">Luk</button>
      </div>
    </div>
  </div>

  <template id="rowTemplate">
    <tr role="row">
      <td role="cell">
        <input type="number" class="table-input col-antal" min="0" placeholder="0" aria-label="Antal" inputmode="numeric" />
      </td>
      <td role="cell">
        <textarea class="table-input table-textarea" rows="1" placeholder="Beskrivelse af vare" aria-label="Beskrivelse"></textarea>
      </td>
      <td role="cell" style="text-align:center;">
        <button class="btn btn-delete" type="button" aria-label="Slet r√¶kke">√ó</button>
      </td>
    </tr>
  </template>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-/K6E8oM6qg3sH2f1lO0vU2c0CwV+E0T8Lk0Qz3y3h5d8K3z2D7B3a0z7nq0qgk9v2Zg9rW9lD2N3O6VQG5k2xA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    // ===== Config =====
    const VALID_CREDENTIALS = { username: 'admin', password: 'felson2025' }; // ‚ö†Ô∏è Demo only; replace server-side in production.
    const STORAGE_KEY = 'felson_folgeseddel_v1';

    // ===== Elements =====
    const els = {
      loginScreen: document.getElementById('loginScreen'),
      loginForm: document.getElementById('loginForm'),
      loginError: document.getElementById('loginError'),
      username: document.getElementById('username'),
      password: document.getElementById('password'),
      demoHint: document.getElementById('demoHint'),

      appContainer: document.getElementById('appContainer'),
      logoutBadge: document.getElementById('logoutBadge'),
      dato: document.getElementById('dato'),
      ordre: document.getElementById('ordre'),
      levering: document.getElementById('levering'),
      tbody: document.getElementById('tbody'),
      footer: document.getElementById('footer'),
      toast: document.getElementById('toast'),
      modal: document.getElementById('modal'),
      badge: document.getElementById('badge'),
      addBtn: document.getElementById('addBtn'),
      clearBtn: document.getElementById('clearBtn'),
      pdfBtn: document.getElementById('pdfBtn'),
      printBtn: document.getElementById('printBtn'),
      acceptBtn: document.getElementById('acceptBtn'),
      closeBtn: document.getElementById('closeBtn'),
      template: document.getElementById('rowTemplate')
    };

    let isAuthenticated = false;

    // ===== Helpers =====
    const qsa = (sel, root = document) => Array.from(root.querySelectorAll(sel));
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    function toast(msg) {
      els.toast.textContent = msg;
      els.toast.classList.add('show');
      clearTimeout(els.toast._t);
      els.toast._t = setTimeout(() => els.toast.classList.remove('show'), 3000);
    }

    function resize(textarea) {
      if (!textarea) return;
      textarea.style.height = 'auto';
      textarea.style.height = Math.max(40, textarea.scrollHeight) + 'px';
    }

    function addRow(antal = '', desc = '') {
      const frag = els.template.content.cloneNode(true);
      const row = frag.querySelector('tr');
      const antalInput = frag.querySelector('.col-antal');
      const descInput = frag.querySelector('.table-textarea');
      if (antal !== '') antalInput.value = antal;
      if (desc) { descInput.value = desc; requestAnimationFrame(() => resize(descInput)); }
      els.tbody.appendChild(frag);
      // Focus first empty field for speed
      requestAnimationFrame(() => {
        const lastRow = els.tbody.lastElementChild;
        const focusEl = lastRow.querySelector('.col-antal');
        focusEl && focusEl.focus();
      });
      persist();
    }

    function clearAll() {
      if (!confirm('Er du sikker p√• at du vil rydde alle data?')) return;
      els.dato.value = '';
      els.ordre.value = '';
      els.levering.value = '';
      els.tbody.innerHTML = '';
      addRow();
      persist();
      toast('üóëÔ∏è Alle data er ryddet');
    }

    // ===== Persistence (localStorage) =====
    function persist() {
      const rows = qsa('tr', els.tbody).map(tr => ({
        antal: tr.querySelector('.col-antal')?.value || '',
        desc: tr.querySelector('.table-textarea')?.value || ''
      }));
      const payload = {
        dato: els.dato.value || '',
        ordre: els.ordre.value || '',
        levering: els.levering.value || '',
        rows
      };
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(payload)); } catch {}
    }

    function restore() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return addRow();
        const data = JSON.parse(raw);
        els.dato.value = data.dato || '';
        els.ordre.value = data.ordre || '';
        els.levering.value = data.levering || '';
        els.tbody.innerHTML = '';
        (data.rows && data.rows.length ? data.rows : [{antal:'',desc:''}]).forEach(r => addRow(r.antal, r.desc));
      } catch { addRow(); }
    }

    // ===== PDF =====
    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });
      const w = doc.internal.pageSize.getWidth();
      const h = doc.internal.pageSize.getHeight();
      const m = 56; // 20mm ‚âà 56pt
      let y = m;
      let page = 1;

      function header() {
        doc.setFillColor(0,176,240); doc.rect(0,0,w,3,'F');
        doc.setFontSize(18); doc.setTextColor(0,176,240); doc.setFont('helvetica','bold');
        doc.text('Felson Watersafe ApS', w - m, 24, { align:'right' });
        doc.setDrawColor(0,176,240); doc.line(m, 28, w - m, 28);
      }
      function footer() {
        const fy = h - m + 8;
        doc.setDrawColor(0,176,240); doc.line(m, fy - 14, w - m, fy - 14);
        doc.setFontSize(8); doc.setTextColor(100); doc.setFont('helvetica','normal');
        doc.text('Felson Watersafe ApS / Gartnervej 4 / 6710 Esbjerg V', w/2, fy, { align:'center' });
        doc.text('CVR-nr. DK26813522 / Tlf. 70206676 / felson@felson.dk', w/2, fy + 12, { align:'center' });
        doc.setFillColor(0,176,240); doc.roundedRect(m - 6, fy - 10, 40, 18, 3, 3, 'F');
        doc.setTextColor(255); doc.setFontSize(9); doc.setFont('helvetica','bold');
        doc.text(`Side ${page}`, m + 14, fy + 3);
      }
      function newPage() { footer(); doc.addPage(); page++; y = m; header(); y = 40; }

      header(); y = 40;

      // Title
      doc.setFillColor(0,176,240); doc.roundedRect(m, y, w - 2*m, 26, 6, 6, 'F');
      doc.setFontSize(14); doc.setTextColor(255); doc.setFont('helvetica','bold');
      doc.text('F√òLGESEDDEL', w/2, y + 17, { align:'center' }); y += 36;

      // Info block
      doc.setFillColor(250,250,250); doc.roundedRect(m, y, w - 2*m, 80, 6, 6, 'F');
      y += 16;
      doc.setFontSize(9); doc.setFont('helvetica','bold'); doc.setTextColor(0,176,240);
      doc.text('DATO', m + 10, y);
      doc.text('LEVERING', w/2 + 10, y);
      doc.setFont('helvetica','normal'); doc.setTextColor(40);
      const danishDate = els.dato.value ? new Date(els.dato.value + 'T00:00:00').toLocaleDateString('da-DK') : '';
      doc.text(danishDate, m + 10, y + 16);
      const levLines = doc.splitTextToSize(els.levering.value || '', (w/2) - (m + 40));
      doc.text(levLines, w/2 + 10, y + 16);
      doc.setFont('helvetica','bold'); doc.setTextColor(0,176,240);
      doc.text('ORDRE NR.', m + 10, y + 36);
      doc.setFont('helvetica','normal'); doc.setTextColor(40);
      doc.text(els.ordre.value || '', m + 10, y + 52);
      y += 80 + 8;

      // Table header
      const th = 24;
      doc.setFillColor(0,176,240); doc.roundedRect(m, y, w - 2*m, th, 6, 6, 'F');
      doc.setTextColor(255); doc.setFont('helvetica','bold'); doc.setFontSize(9);
      doc.text('ANTAL', m + 30, y + 16);
      doc.text('BESKRIVELSE', m + 120, y + 16);
      y += th + 8;

      // Rows
      const rows = Array.from(els.tbody.querySelectorAll('tr'));
      doc.setTextColor(40); doc.setFont('helvetica','normal'); doc.setFontSize(10);

      rows.forEach((row, i) => {
        const antal = (row.querySelector('.col-antal').value || '0') + '';
        const desc = (row.querySelector('.table-textarea').value || '').trim();
        const lines = doc.splitTextToSize(desc, w - (m + 120) - m);
        const rh = Math.max(18, lines.length * 14);

        if (y + rh > h - (m + 54)) {
          newPage();
          // repeat table header
          doc.setFillColor(0,176,240); doc.roundedRect(m, y, w - 2*m, th, 6, 6, 'F');
          doc.setTextColor(255); doc.setFont('helvetica','bold'); doc.setFontSize(9);
          doc.text('ANTAL', m + 30, y + 16);
          doc.text('BESKRIVELSE', m + 120, y + 16);
          y += th + 8;
          doc.setTextColor(40); doc.setFont('helvetica','normal'); doc.setFontSize(10);
        }

        if (i % 2 === 0) { doc.setFillColor(248,250,252); doc.rect(m, y - 6, w - 2*m, rh, 'F'); }
        doc.setTextColor(0,176,240); doc.setFont('helvetica','bold');
        doc.text(antal, m + 30, y + 8);
        doc.setTextColor(40); doc.setFont('helvetica','normal');
        doc.text(lines, m + 120, y + 8);
        doc.setDrawColor(220); doc.line(m, y + rh - 6, w - m, y + rh - 6);
        y += rh + 2;
      });

      footer();
      const fname = `folgeseddel_${(els.ordre.value || 'dokument').replace(/\s+/g,'_')}.pdf`;
      doc.save(fname);
      toast('üìÑ PDF genereret!');
    }

    // ===== Events =====
    // Login
    els.loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const username = els.username.value.trim();
      const password = els.password.value;
      if (username === VALID_CREDENTIALS.username && password === VALID_CREDENTIALS.password) {
        isAuthenticated = true;
        els.loginError.classList.remove('show');
        els.loginScreen.classList.add('hidden');
        els.loginScreen.setAttribute('aria-hidden','true');
        setTimeout(() => {
          els.appContainer.classList.add('visible');
          els.appContainer.setAttribute('aria-hidden','false');
          toast('‚úÖ Login succesfuldt!');
        }, 300);
      } else {
        els.loginError.classList.add('show');
        els.password.value = '';
        els.password.focus();
      }
    });

    // Logout
    els.logoutBadge.addEventListener('click', () => {
      if (confirm('Er du sikker p√• at du vil logge ud?')) {
        isAuthenticated = false;
        els.appContainer.classList.remove('visible');
        els.appContainer.setAttribute('aria-hidden','true');
        setTimeout(() => {
          els.loginScreen.classList.remove('hidden');
          els.loginScreen.setAttribute('aria-hidden','false');
          els.username.value = '';
          els.password.value = '';
          els.loginError.classList.remove('show');
        }, 300);
        toast('üëã Du er nu logget ud');
      }
    });

    // Modal
    els.badge.addEventListener('click', () => { els.modal.classList.add('show'); els.modal.setAttribute('aria-hidden','false'); });
    els.acceptBtn.addEventListener('click', () => { els.modal.classList.remove('show'); els.modal.setAttribute('aria-hidden','true'); toast('‚úÖ Sikkerhedsindstillinger accepteret'); });
    els.closeBtn.addEventListener('click', () => { els.modal.classList.remove('show'); els.modal.setAttribute('aria-hidden','true'); });
    els.modal.addEventListener('click', (e) => { if (e.target === els.modal) { els.modal.classList.remove('show'); els.modal.setAttribute('aria-hidden','true'); } });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { els.modal.classList.remove('show'); els.modal.setAttribute('aria-hidden','true'); } });

    // Table actions
    els.addBtn.addEventListener('click', () => addRow());
    els.clearBtn.addEventListener('click', clearAll);
    els.pdfBtn.addEventListener('click', generatePDF);
    els.printBtn.addEventListener('click', () => { toast('üñ®Ô∏è Forbereder print...'); setTimeout(() => window.print(), 300); });

    els.tbody.addEventListener('click', (e) => {
      if (e.target.classList.contains('btn-delete')) {
        const rows = els.tbody.querySelectorAll('tr');
        if (rows.length > 1) {
          e.target.closest('tr').remove();
          persist();
        } else {
          toast('‚ö†Ô∏è Der skal v√¶re mindst √©n r√¶kke');
        }
      }
    });

    els.tbody.addEventListener('input', (e) => {
      if (e.target.classList.contains('table-textarea')) resize(e.target);
      persist();
    });

    els.tbody.addEventListener('keydown', (e) => {
      const isText = e.target.classList.contains('table-textarea');
      if (isText && e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {
        // Ctrl/Cmd+Enter: ny r√¶kke
        e.preventDefault(); addRow();
      }
      if (isText) requestAnimationFrame(() => resize(e.target));
    });

    ['change','input'].forEach(evt => {
      els.dato.addEventListener(evt, persist);
      els.ordre.addEventListener(evt, persist);
      els.levering.addEventListener(evt, persist);
    });

    // Quick keyboard: Enter on last cell adds new row
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && document.activeElement?.classList.contains('table-textarea') && !e.shiftKey) {
        const lastRow = els.tbody.lastElementChild;
        if (document.activeElement.closest('tr') === lastRow) { e.preventDefault(); addRow(); }
      }
    });

    // ===== Init =====
    if (!els.dato.value) els.dato.valueAsDate = new Date();
    restore();

    // Optional: show demo creds only when not deployed
    // Toggle this to true if you want the demo hint visible
    const SHOW_DEMO_HINT = false;
    if (SHOW_DEMO_HINT) els.demoHint.hidden = false;
  </script>
</body>
</html>
