<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' 'unsafe-inline';">
    <title>Følgeseddel - Felson Watersafe ApS</title>
    <style>
        :root {
            --logo-blue-color: #007BFF;
            --border-color: #dee2e6;
            --text-dark: #212529;
            --text-light: #6c757d;
            --bg-light: #f8f9fa;
        }

        /* --- Global Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f4f9;
            padding: 2rem;
            font-size: 16px;
            color: var(--text-dark);
        }

        /* --- On-Screen Modern Layout --- */
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.07);
            border-radius: 8px;
        }
        
        .content-wrapper {
             padding: 2.5rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem 2.5rem;
            border-bottom: 2px solid var(--logo-blue-color);
        }

        /* Print-only header is hidden on screen */
        .print-header {
            display: none;
        }
        
        #company-logo {
            color: var(--logo-blue-color);
            font-size: 1.75rem;
            font-weight: 600;
        }

        h1 {
            text-align: center;
            margin: 2rem 0;
            font-size: 2.25rem;
        }

        .details-section {
            display: flex;
            gap: 2rem;
            margin-bottom: 2.5rem;
        }
        .details-column {
            flex: 1;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        input[type="text"],
        input[type="date"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        input:focus,
        textarea:focus {
            outline: none;
            border-color: var(--logo-blue-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.15);
        }

        /* Pro Table Style (On-Screen) */
        .items-section table { width: 100%; border-collapse: collapse; }
        .items-section thead th {
            text-align: left; padding: 12px 15px; border-bottom: 2px solid var(--text-dark);
            text-transform: uppercase; font-size: 0.8em; letter-spacing: 0.7px;
        }
        .items-section tbody tr { border-bottom: 1px solid var(--border-color); }
        .items-section tbody tr:last-child { border-bottom: none; }
        .items-section .antal-col { width: 20%; text-align: center; }
        .items-section .beskrivelse-col { width: 70%; }
        .items-section .actions-col { width: 10%; text-align: center; }
        .items-section td { padding: 10px 15px; vertical-align: top; }
        .items-section td input, .items-section td textarea {
            width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; background-color: #fff; font-size: 1rem;
        }
        .items-section .antal-col input { text-align: center; }
        .items-section textarea { resize: vertical; min-height: 42px; }

        .table-actions {
            margin-top: 1.5rem;
        }
        #add-row-btn {
            background-color: #28a745; color: white; border: none; padding: 0.6rem 1.2rem;
            border-radius: 5px; cursor: pointer; font-weight: 500;
        }
        .delete-row-btn {
            background: none; border: none; color: #dc3545; cursor: pointer; font-size: 1.2rem;
        }
        
        .document-footer {
            text-align: center; margin-top: 3rem; padding-top: 1.5rem;
            border-top: 1px solid var(--logo-blue-color); font-size: 0.8rem; color: var(--text-light);
        }

        .action-buttons {
            display: flex; gap: 1rem; justify-content: center; margin: 2rem auto;
        }
        .action-buttons button {
            padding: 0.8rem 2rem; border-radius: 6px; cursor: pointer; font-size: 1rem; font-weight: 600;
            border: 2px solid;
        }
        #save-pdf-btn { background-color: #fff; border-color: var(--border-color); color: var(--text-dark); }
        #print-btn { background-color: var(--logo-blue-color); border-color: var(--logo-blue-color); color: #fff; }

        /* --- Responsiveness --- */
        @media (max-width: 768px) {
            body { padding: 1rem; }
            .container { padding: 0; border-radius: 0; }
            .content-wrapper { padding: 1.5rem; }
            header { justify-content: center; }
            .details-section { flex-direction: column; }
            .items-section table thead { display: none; }
            .items-section table tr { display: block; border: 1px solid var(--border-color); margin-bottom: 1rem; }
            .items-section table td { display: block; text-align: right; border-bottom: 1px solid #eee; }
            .items-section table td:last-child { border-bottom: none; }
            .items-section table td::before { content: attr(data-label); float: left; font-weight: bold; }
        }

        /* --- PRINT STYLES (Matches Word Document Reference) --- */
        @media print {
            @page { size: A4; margin: 2cm; }
            body { background: #fff; padding: 0; font-size: 11pt; }
            * { color: #000 !important; box-shadow: none !important; }

            /* Hide all on-screen UI */
            .action-buttons, #add-row-btn, .delete-row-btn, header {
                display: none !important;
            }

            .container {
                width: 100%; max-width: 100%; padding: 0; margin: 0;
                border: none; box-shadow: none; border-radius: 0;
            }

            /* Display the print-only header, styled like the Word doc */
            .print-header {
                display: block;
                text-align: left;
                margin-bottom: 2rem;
            }
            .print-header h2 {
                font-size: 14pt;
                font-weight: bold;
            }

            h1 { font-size: 18pt; margin: 1.5rem 0; }

            /* Reformat details section to a single block */
            .details-section {
                display: block;
                margin-bottom: 2rem;
            }
            .details-column {
                margin-bottom: 0.5rem;
            }

            /* Classic document table style for printing */
            .items-section table, .items-section th, .items-section td {
                border: 1px solid black;
            }
            .items-section table {
                border-collapse: collapse;
                width: 100%;
                page-break-inside: auto;
            }
            .items-section th, .items-section td {
                padding: 6px 8px;
                text-align: left;
            }
            .items-section .antal-col { text-align: left; } /* Align left for print */
            tr { page-break-inside: avoid; page-break-after: auto; }

            /* Position footer at the bottom */
            .document-footer {
                border-top: 1px solid black;
                text-align: left;
                font-size: 9pt;
                color: #000 !important;
                /* Position footer at the bottom of the content flow */
                margin-top: 3rem;
            }

            .print-value {
                white-space: pre-wrap; /* Preserve newlines */
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <header>
            <h2 id="company-logo">Felson Watersafe ApS</h2>
        </header>

        <div class="content-wrapper">
            <div class="print-header">
                <h2>Felson Watersafe ApS</h2>
            </div>

            <h1>FØLGESEDDEL</h1>

            <section class="details-section">
                <div class="details-column">
                    <div class="form-group">
                        <label for="dato">Dato:</label>
                        <input type="date" id="dato">
                    </div>
                    <div class="form-group">
                        <label for="ordre-nr">Ordre nr.:</label>
                        <input type="text" id="ordre-nr">
                    </div>
                </div>
                <div class="details-column">
                    <label for="levering">Levering:</label>
                    <textarea id="levering" rows="4"></textarea>
                </div>
            </section>

            <section class="items-section">
                <table>
                    <thead>
                        <tr>
                            <th class="antal-col">Antal</th>
                            <th class="beskrivelse-col">Beskrivelse</th>
                            <th class="actions-col"></th>
                        </tr>
                    </thead>
                    <tbody id="items-table-body">
                        <tr>
                            <td class="antal-col" data-label="Antal"><input type="number" class="antal-input" min="0"></td>
                            <td class="beskrivelse-col" data-label="Beskrivelse"><textarea class="beskrivelse-input" rows="1"></textarea></td>
                            <td class="actions-col"><button class="delete-row-btn" title="Slet række">🗑️</button></td>
                        </tr>
                    </tbody>
                </table>
                <div class="table-actions">
                    <button type="button" id="add-row-btn">+ Tilføj Række</button>
                </div>
            </section>
            
            <footer class="document-footer">
                <p>Felson Watersafe ApS / Gartnervej 4 / 6710 Esbjerg V</p>
                <p>CVR-nr. DK26813522 / Tlf. 70206676 / felson@felson.dk</p>
            </footer>
        </div>
    </div>

    <div class="action-buttons">
        <button type="button" id="save-pdf-btn">Gem som PDF</button>
        <button type="button" id="print-btn">Udskriv</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            // --- CORE FUNCTIONALITY ---

            // 1. Set today's date automatically, but allow changes
            const dateInput = document.getElementById('dato');
            if(dateInput) {
                const today = new Date();
                // Format to YYYY-MM-DD for the date input
                today.setMinutes(today.getMinutes() - today.getTimezoneOffset());
                dateInput.valueAsDate = today;
            }

            // 2. Add Row Functionality
            document.getElementById('add-row-btn').addEventListener('click', function() {
                const tbody = document.getElementById('items-table-body');
                const newRow = tbody.rows[0].cloneNode(true);
                
                newRow.querySelectorAll('input, textarea').forEach(input => {
                    input.value = '';
                    if (input.tagName.toLowerCase() === 'textarea') {
                        input.style.height = 'auto'; // Reset height for cloned textarea
                    }
                });
                tbody.appendChild(newRow);
            });

            // 3. Delete Row Functionality (using event delegation)
            const tableBody = document.getElementById('items-table-body');
            tableBody.addEventListener('click', function(e) {
                if (e.target && e.target.classList.contains('delete-row-btn')) {
                    if (tableBody.rows.length > 1) {
                        e.target.closest('tr').remove();
                    } else {
                        alert('Du skal have mindst én række.');
                    }
                }
            });

            // 4. Auto-expanding Textarea
            tableBody.addEventListener('input', function(e) {
                if (e.target && e.target.tagName.toLowerCase() === 'textarea') {
                    e.target.style.height = 'auto';
                    e.target.style.height = (e.target.scrollHeight) + 'px';
                }
            });

            // 5. Robust Print Button Functionality
            const printBtn = document.getElementById('print-btn');
            const savePdfBtn = document.getElementById('save-pdf-btn');
            
            if (printBtn) printBtn.addEventListener('click', prepareAndPrint);
            if (savePdfBtn) savePdfBtn.addEventListener('click', prepareAndPrint);

            function prepareAndPrint() {
                const originalElements = [];
                const inputs = document.querySelectorAll('.container input, .container textarea');

                inputs.forEach(input => {
                    const parent = input.parentNode;
                    originalElements.push({ original: input, parent: parent });

                    const printValue = document.createElement('div');
                    printValue.className = 'print-value';
                    
                    // Preserve newlines from textarea
                    printValue.textContent = input.value;
                    parent.replaceChild(printValue, input);
                });

                window.print();

                // Restore function to bring back input fields
                function restoreInputs() {
                    originalElements.forEach(item => {
                        const printValue = item.parent.querySelector('.print-value');
                        if (printValue) {
                            item.parent.replaceChild(item.original, printValue);
                        }
                    });
                    // Clean up the event listener to avoid memory leaks
                    window.removeEventListener('afterprint', restoreInputs);
                }

                // Use 'afterprint' event which is more reliable
                window.addEventListener('afterprint', restoreInputs);

                // Fallback for browsers that might not fire 'afterprint' consistently
                setTimeout(restoreInputs, 2000); 
            }
        });
    </script>
</body>
</html>
