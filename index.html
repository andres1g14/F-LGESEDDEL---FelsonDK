<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F√∏lgeseddel - Felson Watersafe ApS</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap');

        :root {
            --brand: #00B0F0;
            --text: #1a1a1a;
            --text-light: #6b7280;
            --border: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #00B0F0 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .security-badge {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: rgba(16, 185, 129, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
        }

        .security-badge:hover {
            background: rgba(16, 185, 129, 1);
            transform: scale(1.05);
        }

        .app-container {
            width: 100%;
            max-width: 920px;
            margin: 0 auto;
        }

        .document-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            margin-bottom: 2rem;
        }

        .card-header {
            padding: 2.5rem 3rem 2rem;
            background: linear-gradient(135deg, #ffffff 0%, #f0f9ff 100%);
            border-bottom: 2px solid var(--brand);
            text-align: right;
        }

        .logo {
            color: var(--brand);
            font-size: 2rem;
            font-weight: 800;
        }

        .card-content {
            padding: 3rem;
        }

        .main-title {
            text-align: center;
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 2.5rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 260px 1fr;
            gap: 2rem;
            margin-bottom: 2.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            font-size: 0.8125rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-size: 0.9375rem;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--brand);
            box-shadow: 0 0 0 4px rgba(0, 176, 240, 0.08);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin-top: 1.5rem;
        }

        .data-table thead {
            background: linear-gradient(135deg, var(--brand) 0%, #0090cc 100%);
        }

        .data-table th {
            padding: 1rem;
            text-align: left;
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
        }

        .data-table th.col-antal {
            width: 20%;
            text-align: center;
        }

        .data-table tbody tr {
            background: white;
        }

        .data-table tbody tr:not(:last-child) td {
            border-bottom: 1px solid var(--border);
        }

        .data-table tbody td {
            padding: 0.75rem 1rem;
        }

        .table-input, .table-textarea {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid transparent;
            border-radius: 6px;
            font-size: 0.9375rem;
            font-family: 'Inter', sans-serif;
        }

        .table-input:focus {
            outline: none;
            border-color: var(--brand);
            background: rgba(0, 176, 240, 0.05);
        }

        .table-textarea {
            resize: none;
            overflow: hidden;
            min-height: 2.5rem;
        }

        .table-input.col-antal {
            text-align: center;
            font-weight: 600;
            color: var(--brand);
        }

        .actions-container {
            margin-top: 1rem;
            display: flex;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.625rem 1.25rem;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.8125rem;
            cursor: pointer;
            text-transform: uppercase;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-add {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-clear {
            background: white;
            color: #ef4444;
            border: 1.5px solid #ef4444;
        }

        .btn-delete {
            background: transparent;
            color: #9ca3af;
            font-size: 1.125rem;
        }

        .card-footer {
            padding: 1.5rem 3rem;
            background: white;
            border-top: 2px solid var(--brand);
            text-align: center;
            font-size: 0.8125rem;
            color: var(--text-light);
            line-height: 1.6;
            font-family: 'Poppins', sans-serif;
        }

        .card-footer p {
            margin: 0.25rem 0;
        }

        .main-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-brand {
            background: linear-gradient(135deg, var(--brand) 0%, #0090cc 100%);
            color: white;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: white;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.4s;
            z-index: 10000;
            border: 1px solid var(--border);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .security-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .security-modal.show {
            opacity: 1;
            visibility: visible;
        }

        .security-modal-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            padding: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .security-modal.show .security-modal-content {
            transform: scale(1);
        }

        .security-modal-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--brand);
        }

        .security-modal-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .security-modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
        }

        .security-modal-body {
            color: var(--text-light);
            line-height: 1.7;
            font-size: 0.9375rem;
            margin-bottom: 1.5rem;
        }

        .security-modal-body p {
            margin-bottom: 1rem;
        }

        .security-modal-body strong {
            color: var(--text);
            font-weight: 600;
        }

        .security-modal-features {
            background: #f9fafb;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .security-modal-features ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .security-modal-features li {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .security-modal-features li::before {
            content: '‚úì';
            color: #10b981;
            font-weight: 700;
            font-size: 1.125rem;
        }

        .security-modal-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
        }

        .btn-accept {
            background: linear-gradient(135deg, var(--brand) 0%, #0090cc 100%);
            color: white;
        }

        /* ===== PRINT: Match PDF look & layout ===== */
@media print {

  /* A4 con margen inferior para footer fijo */
  @page {
    size: A4 portrait;
    margin: 15mm 15mm 30mm 15mm; /* top right bottom left */
  }

  /* Forzar colores exactos y tipograf√≠as */
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color-adjust: exact !important;
    font-family: 'Poppins', 'Inter', Arial, sans-serif !important;
  }

  html, body {
    background: #fff !important;
    padding: 0 !important;
    margin: 0 !important;
    width: 100% !important;
    height: 100% !important;
    overflow: visible !important;
  }

  /* Ocultar UI no imprimible */
  .security-badge,
  .main-actions,
  .actions-container,
  .btn-delete,
  .toast,
  .security-modal,
  button {
    display: none !important;
  }

  /* Contenedor al 100% */
  .app-container,
  .document-card {
    max-width: 100% !important;
    width: 100% !important;
    margin: 0 !important;
    border: 0 !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    background: #fff !important;
  }

  /* CABECERA como en PDF: l√≠nea superior + borde inferior azul */
  .card-header {
    padding: 0 0 5mm 0 !important;
    margin: 0 0 5mm 0 !important;
    background: #fff !important;
    border-bottom: 2px solid #00B0F0 !important;
    page-break-after: avoid !important;
    position: relative;
  }
  /* ‚ÄúGradiente superior‚Äù simulado: l√≠nea azul fina como en PDF */
  .card-header::before {
    content: "";
    position: absolute;
    top: -3mm; left: 0; right: 0;
    height: 3mm;
    background: #00B0F0;
  }

  .logo {
    font-size: 18pt !important;
    font-weight: 800 !important;
    color: #00B0F0 !important;
  }

  .card-content {
    padding: 0 !important;
    padding-bottom: 35mm !important; /* espacio para footer fijo */
  }

  /* T√≠tulo ‚ÄúF√òLGESEDDEL‚Äù como la franja azul del PDF */
  .main-title {
    font-size: 14pt !important;
    font-weight: 700 !important;
    font-family: 'Poppins', sans-serif !important;
    color: #fff !important;
    background: #00B0F0 !important;
    text-align: center !important;
    text-transform: uppercase !important;
    letter-spacing: .2em !important;
    padding: 3mm 5mm !important;
    margin: 0 0 5mm 0 !important;
    border-radius: 2mm !important;
    page-break-after: avoid !important;
  }

  /* Bloque de formulario con dos columnas como en PDF */
  .form-grid {
    display: grid !important;
    grid-template-columns: 35% 65% !important;
    gap: 4mm !important;
    padding: 3mm !important;
    margin-bottom: 5mm !important;
    background: #f5f5f5 !important;
    border-radius: 2mm !important;
    page-break-inside: avoid !important;
  }
  .form-label {
    color: #00B0F0 !important;
    font-weight: 700 !important;
    font-size: 8pt !important;
    text-transform: uppercase !important;
    margin-bottom: 1mm !important;
  }
  .form-input, .form-textarea {
    border: none !important;
    padding: 0 !important;
    font-size: 9pt !important;
    color: #000 !important;
    background: transparent !important;
  }

  /* Tabla */
  .data-table {
    width: 100% !important;
    border-collapse: collapse !important;
    border: 1px solid #ccc !important;
    margin-top: 5mm !important;
    margin-bottom: 8mm !important;
  }
  /* Encabezado SIEMPRE en cada p√°gina */
  .data-table thead { display: table-header-group !important; }
  .data-table tfoot { display: table-footer-group !important; }

  .data-table thead tr th {
    background: #00B0F0 !important;
    color: #fff !important;
    font-weight: 700 !important;
    font-size: 8.5pt !important;
    padding: 3mm 2mm !important;
    border: none !important;
    text-transform: uppercase !important;
  }
  .data-table th.col-antal { text-align: center !important; width: 20% !important; }

  .data-table tbody tr { page-break-inside: avoid !important; }
  .data-table tbody tr:nth-child(even) { background: #f9f9f9 !important; }
  .data-table tbody td {
    font-size: 9pt !important;
    color: #000 !important;
    padding: 2.5mm 2mm !important;
    border-bottom: 1px solid #ddd !important;
  }
  .table-input, .table-textarea {
    border: none !important;
    padding: 0 !important;
    font-size: 9pt !important;
    background: transparent !important;
    color: #000 !important;
  }
  .table-input.col-antal {
    color: #00B0F0 !important;
    font-weight: 700 !important;
    text-align: center !important;
  }

  /* FOOTER FIJO EN TODAS LAS P√ÅGINAS (como el PDF) */
  .card-footer {
    position: fixed !important;
    left: 0 !important; right: 0 !important; bottom: 0 !important;
    width: 100% !important;
    padding: 4mm 15mm !important;
    background: #fff !important;
    border-top: 2px solid #00B0F0 !important;
    text-align: center !important;
    z-index: 9999 !important;
  }
  .card-footer p {
    font-size: 8pt !important;
    margin: 1mm 0 !important;
    color: #666 !important;
    line-height: 1.5 !important;
  }

  /* Badge de n√∫mero de p√°gina como el ‚ÄúSide X‚Äù del PDF */
  .card-footer::before {
    content: "Side " counter(page);
    position: absolute;
    left: 15mm;
    bottom: 6mm;
    display: inline-block;
    padding: 1mm 4mm;
    border-radius: 2mm;
    background: #00B0F0;
    color: #fff;
    font-weight: 700;
    font-size: 8pt;
  }

  /* Quitar controles nativos de inputs en impresi√≥n */
  input[type="date"]::-webkit-calendar-picker-indicator,
  input[type="number"]::-webkit-inner-spin-button,
  input[type="number"]::-webkit-outer-spin-button {
    display: none !important;
    -webkit-appearance: none !important;
  }
/* === PRINT: footer fijo exactamente dentro de los m√°rgenes === */
@media print {
  /* Define tus m√°rgenes y altura del footer UNA SOLA VEZ */
  :root{
    --mT: 15mm;        /* margen superior */
    --mR: 15mm;        /* margen derecho  */
    --mB: 30mm;        /* margen inferior (>= altura del footer) */
    --mL: 15mm;        /* margen izquierdo */
    --footerH: 84mm;   /* altura real del footer */
  }

  @page {
    size: A4 portrait;
    margin: var(--mT) var(--mR) var(--mB) var(--mL);
  }

  /* Reserva hueco en el contenido para que nunca pise al footer */
  .card-content{
    padding-bottom: var(--footerH) !important;
  }

  /* Fija el footer alineado con los m√°rgenes de la p√°gina */
  .card-footer{
    position: fixed !important;

    /* OJO: ancla a la caja de la p√°gina usando los mismos m√°rgenes */
    left:   var(--mL) !important;
    right:  var(--mR) !important;

    /* Col√≥calo justo encima del margen inferior:
       bottom = margenBajo - alturaFooter  ‚Üí as√≠ su base queda a --mB */
    bottom: calc(var(--mB) - var(--footerH)) !important;

    height: var(--footerH) !important;

    /* Estilo (los tuyos) */
    background: #fff !important;
    border-top: 2px solid #00B0F0 !important;
    padding: 6mm 0 0 !important;   /* ajusta si quieres m√°s/menos aire */
    text-align: center !important;
    z-index: 9999 !important;
  }

  .card-footer p{
    margin: 1mm 0 !important;
    color: #666 !important;
    font-size: 8pt !important;
    line-height: 1.5 !important;
  }

  /* Etiqueta "Side N" dentro del pie */
  .card-footer::before{
    content: "Side " counter(page);
    position: absolute;
    left: 0;                 /* dentro del ancho √∫til del footer */
    transform: translateX(-6mm); /* opcional: s√°calo un pel√≠n a la izquierda */
    bottom: 6mm;
    display: inline-block;
    padding: 1mm 4mm;
    border-radius: 2mm;
    background: #00B0F0;
    color: #fff;
    font-weight: 700;
    font-size: 8pt;
  }
}

    </style>
</head>
<body>
    <div class="security-badge" id="securityBadge">üîí Sikker og krypteret</div>

    <main class="app-container">
        <div class="document-card">
            <header class="card-header">
                <h1 class="logo">Felson Watersafe ApS</h1>
            </header>

            <div class="card-content">
                <h2 class="main-title">F√∏lgeseddel</h2>

                <div class="form-grid">
                    <div>
                        <div class="form-group">
                            <label for="dato" class="form-label">Dato</label>
                            <input type="date" class="form-input" id="dato">
                        </div>
                        <div class="form-group">
                            <label for="ordre-nr" class="form-label">Ordre nr.</label>
                            <input type="text" class="form-input" id="ordre-nr" placeholder="Indtast ordrenummer">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label for="levering" class="form-label">Levering</label>
                            <textarea class="form-textarea" id="levering" placeholder="Indtast leveringsadresse" style="min-height: 90px;"></textarea>
                        </div>
                    </div>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="col-antal">Antal</th>
                            <th>Beskrivelse</th>
                            <th style="width: 60px;"></th>
                        </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>

                <div class="actions-container">
                    <button class="btn btn-add" id="btn-add">+ Tilf√∏j R√¶kke</button>
                    <button class="btn btn-clear" id="btn-clear">Ryd Alt</button>
                </div>
            </div>

            <footer class="card-footer">
                <p>Felson Watersafe ApS / Gartnervej 4 / 6710 Esbjerg V</p>
                <p>CVR-nr. DK26813522 / Tlf. 70206676 / felson@felson.dk</p>
            </footer>
        </div>

        <div class="main-actions">
            <button class="btn btn-brand" id="btn-pdf">üìÑ Generer PDF</button>
            <button class="btn btn-primary" id="btn-print">üñ®Ô∏è Udskriv</button>
        </div>
    </main>

    <div class="toast" id="toast"></div>

    <div class="security-modal" id="securityModal">
        <div class="security-modal-content">
            <div class="security-modal-header">
                <div class="security-modal-icon">üîí</div>
                <h3 class="security-modal-title">Sikkerhed og Databeskyttelse</h3>
            </div>
            <div class="security-modal-body">
                <p>
                    Velkommen til Felson Watersafe ApS f√∏lgeseddel system. Vi tager din datasikkerhed alvorligt og √∏nsker at informere dig om, hvordan dine oplysninger beskyttes.
                </p>
                
                <div class="security-modal-features">
                    <ul>
                        <li>AES-256 kryptering af alle gemte data</li>
                        <li>Lokal lagring uden eksterne servere</li>
                        <li>Automatisk krypteret backup</li>
                        <li>Ingen data deles med tredjeparter</li>
                        <li>GDPR-kompatibel databehandling</li>
                    </ul>
                </div>

                <p>
                    <strong>Hvordan fungerer det?</strong><br>
                    Alle dine f√∏lgesedler gemmes krypteret i din browsers lokale hukommelse ved hj√¶lp af avanceret AES-256 kryptering. Dette sikrer, at kun du kan tilg√• dine data. Ingen oplysninger sendes til eksterne servere eller deles med nogen.
                </p>

                <p>
                    <strong>Din databeskyttelse:</strong><br>
                    Vi f√∏lger GDPR (General Data Protection Regulation) retningslinjer. Du har fuld kontrol over dine data og kan til enhver tid slette dem ved at bruge "Ryd Alt" funktionen. Dine ordreoplysninger forbliver fortrolige og sikre.
                </p>

                <p style="font-size: 0.875rem; color: #9ca3af; margin-top: 1.5rem;">
                    Ved at forts√¶tte accepterer du vores sikkerhedspraksis og bekr√¶fter, at du har l√¶st denne information om databeskyttelse.
                </p>
            </div>
            <div class="security-modal-actions">
                <button class="btn btn-accept" id="acceptSecurityBtn">Forst√•et og Accepter</button>
            </div>
        </div>
    </div>

    <template id="table-row-template">
        <tr>
            <td><input type="number" class="table-input col-antal" min="0" placeholder="0"></td>
            <td><textarea class="table-input table-textarea" rows="1" placeholder="Beskrivelse af vare"></textarea></td>
            <td style="text-align: center;"><button class="btn btn-delete">√ó</button></td>
        </tr>
    </template>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        (function() {
            'use strict';

            const { jsPDF } = window.jspdf;
            const STORAGE_KEY = 'felson_encrypted_data';
            const ENCRYPTION_KEY = 'FelsonWatersafe2025SecureKey';
            const SECURITY_ACCEPTED_KEY = 'felson_security_accepted';
            
            let autoSaveTimeout;

            function encrypt(data) {
                return CryptoJS.AES.encrypt(JSON.stringify(data), ENCRYPTION_KEY).toString();
            }

            function decrypt(encrypted) {
                try {
                    const bytes = CryptoJS.AES.decrypt(encrypted, ENCRYPTION_KEY);
                    return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
                } catch (e) {
                    return null;
                }
            }

            function addRow(antal = '', beskrivelse = '') {
                const tableBody = document.getElementById('table-body');
                const rowTemplate = document.getElementById('table-row-template');
                const newRow = rowTemplate.content.cloneNode(true);
                const antalInput = newRow.querySelector('.col-antal');
                const beskrivelseTextarea = newRow.querySelector('.table-textarea');
                
                if (antal) antalInput.value = antal;
                if (beskrivelse) {
                    beskrivelseTextarea.value = beskrivelse;
                    setTimeout(() => autoResizeTextarea(beskrivelseTextarea), 0);
                }
                
                tableBody.appendChild(newRow);
                triggerAutoSave();
            }

            function autoResizeTextarea(textarea) {
                if (!textarea) return;
                textarea.style.height = 'auto';
                textarea.style.height = Math.max(40, textarea.scrollHeight) + 'px';
            }

            function showToast(message) {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.classList.add('show');
                setTimeout(() => toast.classList.remove('show'), 3000);
            }

            function generatePDF() {
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 20;
                const footerHeight = 25;
                const usableHeight = pageHeight - footerHeight - 30;
                
                let currentY = margin;
                let pageNumber = 1;
                let isFirstPage = true;

                function drawHeader() {
                    // Gradiente superior (simulado con rect√°ngulo)
                    doc.setFillColor(0, 176, 240);
                    doc.rect(0, 0, pageWidth, 3, 'F');
                    
                    // Logo con sombra efecto
                    doc.setFontSize(18);
                    doc.setTextColor(0, 176, 240);
                    doc.setFont('helvetica', 'bold');
                    doc.text('Felson Watersafe ApS', pageWidth - margin, 16, { align: 'right' });
                    
                    // L√≠nea decorativa
                    doc.setDrawColor(0, 176, 240);
                    doc.setLineWidth(0.5);
                    doc.line(margin, 20, pageWidth - margin, 20);
                }

                function drawCompanyInfo() {
                    // Box con informaci√≥n de la empresa - solo primera p√°gina
                    doc.setFillColor(245, 250, 255); // Azul muy claro
                    doc.roundedRect(margin, currentY, 70, 25, 2, 2, 'F');
                    
                    doc.setFontSize(7);
                    doc.setTextColor(60, 60, 60);
                    doc.setFont('helvetica', 'normal');
                    
                    const infoY = currentY + 4;
                    doc.text('Felson Watersafe ApS', margin + 3, infoY);
                    doc.text('Gartnervej 4', margin + 3, infoY + 4);
                    doc.text('6710 Esbjerg V', margin + 3, infoY + 8);
                    doc.text('CVR-nr. DK26813522', margin + 3, infoY + 12);
                    doc.text('Tlf. 70206676', margin + 3, infoY + 16);
                    doc.text('felson@felson.dk', margin + 3, infoY + 20);
                    
                    currentY += 28;
                }

                function drawFooter() {
                    const footerY = pageHeight - 20;
                    
                    // L√≠nea decorativa superior
                    doc.setDrawColor(0, 176, 240);
                    doc.setLineWidth(0.5);
                    doc.line(margin, footerY - 5, pageWidth - margin, footerY - 5);
                    
                    // Gradiente inferior (simulado)
                    doc.setFillColor(240, 248, 255);
                    doc.rect(0, footerY - 3, pageWidth, 1, 'F');
                    
                    doc.setFontSize(7);
                    doc.setTextColor(100);
                    doc.setFont('helvetica', 'normal');
                    doc.text('Felson Watersafe ApS / Gartnervej 4 / 6710 Esbjerg V', pageWidth / 2, footerY, { align: 'center' });
                    doc.text('CVR-nr. DK26813522 / Tlf. 70206676 / felson@felson.dk', pageWidth / 2, footerY + 4, { align: 'center' });
                    
                    // N√∫mero de p√°gina con estilo
                    doc.setFillColor(0, 176, 240);
                    doc.roundedRect(margin - 2, footerY - 2, 15, 6, 1, 1, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(8);
                    doc.setFont('helvetica', 'bold');
                    doc.text(`Side ${pageNumber}`, margin + 5.5, footerY + 2, { align: 'center' });
                }

                function addNewPage() {
                    drawFooter();
                    doc.addPage();
                    pageNumber++;
                    isFirstPage = false;
                    currentY = margin;
                    drawHeader();
                    currentY = 25;
                }

                // Primera p√°gina
                drawHeader();
                currentY = 25;
                
                // Info de empresa en primera p√°gina
                drawCompanyInfo();

                // T√≠tulo con efecto moderno
                doc.setFillColor(0, 176, 240);
                doc.roundedRect(margin, currentY, pageWidth - 2 * margin, 10, 2, 2, 'F');
                doc.setFontSize(14);
                doc.setTextColor(255, 255, 255);
                doc.setFont('helvetica', 'bold');
                doc.text('F√òLGESEDDEL', pageWidth / 2, currentY + 6.5, { align: 'center' });
                currentY += 14;

                const datoInput = document.getElementById('dato');
                const ordreNrInput = document.getElementById('ordre-nr');
                const leveringInput = document.getElementById('levering');

                // Secci√≥n de datos con fondo
                doc.setFillColor(250, 250, 250);
                doc.roundedRect(margin, currentY, pageWidth - 2 * margin, 26, 2, 2, 'F');
                
                currentY += 4;
                doc.setFontSize(8);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(0, 176, 240);
                doc.text('DATO', margin + 3, currentY);
                doc.text('LEVERING', pageWidth / 2 + 5, currentY);
                
                doc.setFontSize(9);
                doc.setTextColor(40, 40, 40);
                doc.setFont('helvetica', 'normal');
                const fecha = datoInput.value ? new Date(datoInput.value + 'T00:00:00').toLocaleDateString('da-DK') : '';
                doc.text(fecha, margin + 3, currentY + 5);
                
                const leveringLines = doc.splitTextToSize(leveringInput.value || '', pageWidth / 2 - 30);
                doc.text(leveringLines, pageWidth / 2 + 5, currentY + 5);

                doc.setFontSize(8);
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(0, 176, 240);
                doc.text('ORDRE NR.', margin + 3, currentY + 10);
                doc.setFontSize(9);
                doc.setTextColor(40, 40, 40);
                doc.setFont('helvetica', 'normal');
                doc.text(ordreNrInput.value || '', margin + 3, currentY + 15);
                
                currentY += Math.max(24, leveringLines.length * 5 + 16);

                // Tabla con efecto moderno
                doc.setFillColor(0, 176, 240);
                doc.roundedRect(margin, currentY, pageWidth - 2 * margin, 9, 2, 2, 'F');
                doc.setTextColor(255);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.text('ANTAL', margin + 5, currentY + 6);
                doc.text('BESKRIVELSE', margin + 35, currentY + 6);
                currentY += 11;

                const tableBody = document.getElementById('table-body');
                const rows = Array.from(tableBody.querySelectorAll('tr'));
                doc.setTextColor(40, 40, 40);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(9);

                rows.forEach((row, index) => {
                    const antal = row.querySelector('.col-antal').value || '0';
                    const beskrivelse = row.querySelector('.table-textarea').value || '';
                    
                    const beskrivelseLines = doc.splitTextToSize(beskrivelse, pageWidth - margin - 45);
                    const rowHeight = Math.max(7, beskrivelseLines.length * 5);

                    if (currentY + rowHeight > usableHeight) {
                        addNewPage();
                        
                        // Re-dibujar header de tabla
                        doc.setFillColor(0, 176, 240);
                        doc.roundedRect(margin, currentY, pageWidth - 2 * margin, 9, 2, 2, 'F');
                        doc.setTextColor(255);
                        doc.setFont('helvetica', 'bold');
                        doc.setFontSize(8);
                        doc.text('ANTAL', margin + 5, currentY + 6);
                        doc.text('BESKRIVELSE', margin + 35, currentY + 6);
                        currentY += 11;
                        doc.setTextColor(40, 40, 40);
                        doc.setFont('helvetica', 'normal');
                        doc.setFontSize(9);
                    }

                    // Fila con fondo alternado
                    if (index % 2 === 0) {
                        doc.setFillColor(248, 250, 252);
                        doc.rect(margin, currentY - 1, pageWidth - 2 * margin, rowHeight, 'F');
                    }

                    doc.setTextColor(0, 176, 240);
                    doc.setFont('helvetica', 'bold');
                    doc.text(antal, margin + 15, currentY + 4, { align: 'center' });
                    doc.setTextColor(40, 40, 40);
                    doc.setFont('helvetica', 'normal');
                    doc.text(beskrivelseLines, margin + 35, currentY + 4);
                    
                    doc.setDrawColor(220, 220, 220);
                    doc.setLineWidth(0.2);
                    doc.line(margin, currentY + rowHeight, pageWidth - margin, currentY + rowHeight);
                    
                    currentY += rowHeight + 1;
                });

                drawFooter();
                doc.save(`folgeseddel_${ordreNrInput.value || 'dokument'}.pdf`);
                showToast('PDF genereret!');
            }

            function saveData() {
                const datoInput = document.getElementById('dato');
                const ordreNrInput = document.getElementById('ordre-nr');
                const leveringInput = document.getElementById('levering');
                const tableBody = document.getElementById('table-body');
                
                const data = {
                    dato: datoInput.value,
                    ordreNr: ordreNrInput.value,
                    levering: leveringInput.value,
                    rows: Array.from(tableBody.querySelectorAll('tr')).map(row => ({
                        antal: row.querySelector('.col-antal').value,
                        beskrivelse: row.querySelector('.table-textarea').value
                    }))
                };
                
                try {
                    const encrypted = encrypt(data);
                    localStorage.setItem(STORAGE_KEY, encrypted);
                } catch (e) {
                    console.error('Error saving:', e);
                }
            }

            function loadData() {
                try {
                    const encrypted = localStorage.getItem(STORAGE_KEY);
                    if (!encrypted) return false;
                    
                    const data = decrypt(encrypted);
                    if (!data) return false;
                    
                    document.getElementById('dato').value = data.dato || '';
                    document.getElementById('ordre-nr').value = data.ordreNr || '';
                    document.getElementById('levering').value = data.levering || '';
                    
                    const tableBody = document.getElementById('table-body');
                    tableBody.innerHTML = '';
                    if (data.rows?.length) {
                        data.rows.forEach(row => addRow(row.antal, row.beskrivelse));
                    } else {
                        addRow();
                    }
                    return true;
                } catch (e) {
                    return false;
                }
            }

            function clearAllData() {
                if (!confirm('Er du sikker p√• at du vil rydde alle data?')) return;
                document.getElementById('dato').value = '';
                document.getElementById('ordre-nr').value = '';
                document.getElementById('levering').value = '';
                const tableBody = document.getElementById('table-body');
                tableBody.innerHTML = '';
                addRow();
                localStorage.removeItem(STORAGE_KEY);
                showToast('Alle data er ryddet');
            }

            function triggerAutoSave() {
                clearTimeout(autoSaveTimeout);
                autoSaveTimeout = setTimeout(saveData, 1000);
            }

            function init() {
                const securityModal = document.getElementById('securityModal');
                const securityBadge = document.getElementById('securityBadge');
                const acceptSecurityBtn = document.getElementById('acceptSecurityBtn');
                const datoInput = document.getElementById('dato');
                const ordreNrInput = document.getElementById('ordre-nr');
                const leveringInput = document.getElementById('levering');
                const tableBody = document.getElementById('table-body');
                const addRowBtn = document.getElementById('btn-add');
                const clearBtn = document.getElementById('btn-clear');
                const printBtn = document.getElementById('btn-print');
                const pdfBtn = document.getElementById('btn-pdf');

                // Security badge click
                securityBadge.onclick = function() {
                    securityModal.classList.add('show');
                };

                // Check security acceptance
                const accepted = localStorage.getItem(SECURITY_ACCEPTED_KEY);
                if (!accepted) {
                    setTimeout(() => securityModal.classList.add('show'), 500);
                }

                // Accept button
                acceptSecurityBtn.onclick = function() {
                    localStorage.setItem(SECURITY_ACCEPTED_KEY, 'true');
                    securityModal.classList.remove('show');
                    showToast('Sikkerhedsindstillinger accepteret');
                };

                // Close modal on background click
                securityModal.onclick = function(e) {
                    if (e.target === securityModal) {
                        securityModal.classList.remove('show');
                    }
                };

                // Button events
                addRowBtn.onclick = () => addRow();
                clearBtn.onclick = clearAllData;
                pdfBtn.onclick = generatePDF;
                
                // SOLUCI√ìN PROFESIONAL PARA PRINT - Duplicar footer en cada p√°gina
                printBtn.onclick = () => {
                    showToast('Preparando impresi√≥n...');
                    setTimeout(() => {
                        prepareForPrint();
                        window.print();
                    }, 500);
                };

                // Eventos de impresi√≥n del navegador
                window.addEventListener('beforeprint', prepareForPrint);
                window.addEventListener('afterprint', cleanupAfterPrint);

                // Input events
                [datoInput, ordreNrInput, leveringInput].forEach(input => {
                    input.addEventListener('input', triggerAutoSave);
                });

                // Table events
                tableBody.addEventListener('click', (e) => {
                    if (e.target.classList.contains('btn-delete')) {
                        if (tableBody.rows.length > 1) {
                            e.target.closest('tr').remove();
                            triggerAutoSave();
                        } else {
                            showToast('Der skal v√¶re mindst √©n r√¶kke');
                        }
                    }
                });

                tableBody.addEventListener('input', (e) => {
                    if (e.target.classList.contains('table-textarea')) {
                        autoResizeTextarea(e.target);
                    }
                    triggerAutoSave();
                });

                // Load data and init
                const hasData = loadData();
                if (!datoInput.value) datoInput.valueAsDate = new Date();
                if (tableBody.rows.length === 0) addRow();
                if (hasData) showToast('Data indl√¶st');
            }

            // Funci√≥n para preparar el documento para impresi√≥n
            function prepareForPrint() {
                const originalFooter = document.querySelector('.card-footer');
                if (!originalFooter) return;

                // Ocultar el footer original
                originalFooter.style.display = 'none';
                originalFooter.setAttribute('data-original-footer', 'true');

                // Obtener altura de p√°gina A4 en p√≠xeles (aproximadamente 1123px para 297mm)
                const pageHeight = 1050; // Altura √∫til aproximada en p√≠xeles
                const footerHeight = 80; // Altura del footer
                const contentHeight = pageHeight - footerHeight - 100; // Margen de seguridad

                const tableBody = document.getElementById('table-body');
                const rows = Array.from(tableBody.querySelectorAll('tr'));
                
                let currentHeight = 0;
                let pageBreaksInserted = 0;

                // Calcular altura inicial (header + t√≠tulo + formulario)
                const header = document.querySelector('.card-header');
                const title = document.querySelector('.main-title');
                const form = document.querySelector('.form-grid');
                const tableHeader = document.querySelector('.data-table thead');

                currentHeight += (header?.offsetHeight || 0) + 
                               (title?.offsetHeight || 0) + 
                               (form?.offsetHeight || 0) + 
                               (tableHeader?.offsetHeight || 0) + 100;

                // Insertar footers despu√©s de cada grupo de filas que llene una p√°gina
                rows.forEach((row, index) => {
                    const rowHeight = row.offsetHeight || 40;
                    currentHeight += rowHeight;

                    // Si excedemos la altura de p√°gina, insertar footer
                    if (currentHeight > contentHeight || index === rows.length - 1) {
                        const footerClone = originalFooter.cloneNode(true);
                        footerClone.removeAttribute('data-original-footer');
                        footerClone.classList.add('print-footer-clone');
                        footerClone.style.display = 'block';
                        footerClone.style.pageBreakBefore = 'avoid';
                        footerClone.style.pageBreakAfter = index === rows.length - 1 ? 'auto' : 'always';
                        footerClone.style.marginTop = '10mm';
                        
                        row.parentNode.insertBefore(footerClone, row.nextSibling);
                        pageBreaksInserted++;
                        
                        // Reiniciar altura para nueva p√°gina
                        currentHeight = (tableHeader?.offsetHeight || 0) + rowHeight + 80;
                    }
                });

                console.log(`Footers insertados: ${pageBreaksInserted + 1}`);
            }

            // Funci√≥n para limpiar despu√©s de imprimir
            function cleanupAfterPrint() {
                // Restaurar footer original
                const originalFooter = document.querySelector('[data-original-footer="true"]');
                if (originalFooter) {
                    originalFooter.style.display = '';
                    originalFooter.removeAttribute('data-original-footer');
                }

                // Eliminar todos los footers clonados
                const clonedFooters = document.querySelectorAll('.print-footer-clone');
                clonedFooters.forEach(footer => footer.remove());

                console.log('Limpieza completada');
            }

            // Start when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>
</html>
